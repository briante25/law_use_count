<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <title>æ³•æ¢å‡ºç¾é »ç‡çµ±è¨ˆ</title>
    <style>
        body {
            font-family: "Helvetica Neue", sans-serif;
            padding: 20px;
        }

        input,
        button,
        select {
            padding: 8px;
            font-size: 16px;
            margin-right: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 14px;
        }

        th,
        td {
            padding: 4px;
            border: 1px solid #ccc;
            text-align: left;
        }

        th {
            background-color: #f4f4f4;
        }
    </style>
</head>

<body>
    <h2>ğŸ“Š æ³•æ¢å‡ºç¾é »ç‡çµ±è¨ˆ</h2>

    <label for="law">æ³•è¦åç¨±ï¼š</label>
    <select id="law">
        <option value="åˆ‘äº‹è¨´è¨Ÿæ³•">åˆ‘äº‹è¨´è¨Ÿæ³•</option>
        <option value="åˆ‘æ³•">åˆ‘æ³•</option>
        <option value="æ°‘æ³•">æ°‘æ³•</option>
        <option value="æ°‘äº‹è¨´è¨Ÿæ³•">æ°‘äº‹è¨´è¨Ÿæ³•</option>
        <option value="å…¬å¸æ³•">å…¬å¸æ³•</option>
        <option value="ç¥¨æ“šæ³•">ç¥¨æ“šæ³•</option>
        <option value="è­‰äº¤æ³•">è­‰äº¤æ³•</option>
        <option value="ä¿éšªæ³•">ä¿éšªæ³•</option>
        <option value="å¼·åˆ¶åŸ·è¡Œæ³•">å¼·åˆ¶åŸ·è¡Œæ³•</option>
        <option value="åœ‹éš›ç§æ³•">åœ‹éš›ç§æ³•</option>
    </select>

    <label for="article">æ¢è™Ÿï¼š</label>
    <input type="text" id="article" placeholder="ä¾‹å¦‚ï¼šç¬¬5æ¢" onkeydown="if(event.key==='Enter'){submitEntry();}">
    <button onclick="submitEntry()">é€å‡º</button>

    <table id="statsTable">
        <thead>
            <tr>
                <th>æ³•è¦åç¨±</th>
                <th>æ¢è™Ÿ</th>
                <th>è¼¸å…¥æ¬¡æ•¸</th>
            </tr>
        </thead>
        <tbody>
            <!-- è‡ªå‹•ç”Ÿæˆ -->
        </tbody>
    </table>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAGl8F5fZzkVSk4nS72X6VqFRT2tt1uwoI",
            authDomain: "lawusecount.firebaseapp.com",
            databaseURL: "https://lawusecount-default-rtdb.firebaseio.com",
            projectId: "lawusecount",
            storageBucket: "lawusecount.appspot.com",
            messagingSenderId: "839955573501",
            appId: "1:839955573501:web:679c95edcc48a0e4b32c94",
            measurementId: "G-VH1F4SCKNL"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let stats = {};

        window.submitEntry = async function() {
            const law = document.getElementById('law').value;
            let article = document.getElementById('article').value.trim();
            if (!article) { alert("è«‹è¼¸å…¥æ¢è™Ÿï¼"); return; }
            if (!/^ç¬¬.*æ¢$/.test(article)) {
                article = `ç¬¬${article.replace(/[^\d]/g, '')}æ¢`;
            }
            const key = `${law} - ${article}`;
            stats[key] = (stats[key] || 0) + 1;
            renderTable();
            await saveToFirebase();
            document.getElementById('article').value = '';
        }

        function renderTable() {
            const tbody = document.querySelector('#statsTable tbody');
            tbody.innerHTML = '';
            const grouped = {};
            Object.keys(stats).forEach(key => {
                const [law, article] = key.split(' - ');
                if (!grouped[law]) grouped[law] = [];
                grouped[law].push({ article, count: stats[key] });
            });
            Object.keys(grouped).sort().forEach(law => {
                const lawRow = `<tr><td colspan="3" style="font-weight:bold;">${law}</td></tr>`;
                tbody.insertAdjacentHTML('beforeend', lawRow);
                grouped[law].sort((a, b) => a.article.localeCompare(b.article)).forEach(item => {
                    const key = `${law} - ${item.article}`;
                    const row = `<tr>
                        <td></td>
                        <td style="padding-left:2em;">${item.article}</td>
                        <td>
                            ${item.count}æ¬¡
                            <button onclick="changeCount('${key}', 1)">ï¼‹</button>
                            <button onclick="changeCount('${key}', -1)">ï¼</button>
                        </td>
                    </tr>`;
                    tbody.insertAdjacentHTML('beforeend', row);
                });
            });
        }

        window.changeCount = async function(key, delta) {
            if (!stats[key]) stats[key] = 0;
            stats[key] += delta;
            if (stats[key] < 1) { delete stats[key]; }
            renderTable();
            await saveToFirebase();
        }

        async function saveToFirebase() {
            await set(ref(db, "lawStats/main"), stats);
            console.log("å·²åŒæ­¥åˆ° Realtime Database");
        }

        async function loadFromFirebase() {
            const snapshot = await get(child(ref(db), "lawStats/main"));
            if (snapshot.exists()) {
                stats = snapshot.val();
                renderTable();
            }
        }

        window.onload = function() {
            loadFromFirebase();
        };
    </script>
</body>

</html>